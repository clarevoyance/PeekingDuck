****************************
Instance Segmentation Models
****************************

List of Instance Segmentation Models
====================================

The table below shows the instance segmentation models available.

+------------------------+---------------------------------+
| Model                  | Documentation                   |
+========================+=================================+
| Mask R-CNN             | :mod:`model.mask_rcnn`          |
+------------------------+---------------------------------+
| YolactEdge             | :mod:`model.yolact_edge`        |
+------------------------+---------------------------------+

Benchmarks
==========

Inference Speed
---------------

The table below shows the frames per second (FPS) of each model type.

+--------------+------------+-----------+-------------------+-------------------+
|              |            |           | CPU               | GPU               |
|              |            |           +--------+----------+--------+----------+
| Model        | Type       | Size      | single | multiple | single | multiple |
+==============+============+===========+========+==========+========+==========+
|              | r50-fpn    | 800-1333  | 0.76   | 0.72     | 22.30  | 18.58    |
+              +------------+-----------+--------+----------+--------+----------+
| Mask R-CNN   | r101-fpn   | 800-1333  | 0.61   | 0.57     | 17.14  | 14.83    |
+--------------+------------+-----------+--------+----------+--------+----------+
|              | r50-fpn    | 800-1333  | 2.99   | 2.93     | 40.84  | 33.94    |
+              +------------+-----------+--------+----------+--------+----------+
| YolactEdge   | r101-fpn   | 800-1333  | 2.32   | 2.27     | 29.55  | 25.89    |
+              +------------+-----------+--------+----------+--------+----------+
|              | mobilenetv2| 800-1333  | 4.93   | 4.64     | 48.59  | 36.66    |
+--------------+------------+-----------+--------+----------+--------+----------+

Hardware
^^^^^^^^

The following hardware were used to conduct the FPS benchmarks:
 | - ``CPU``: 2.8 GHz 4-Core Intel Xeon (2020, Cascade Lake) CPU and 16GB RAM
 | - ``GPU``: NVIDIA A100, paired with 2.2 GHz 6-Core Intel Xeon CPU and 85GB RAM

Test Conditions
^^^^^^^^^^^^^^^

The following test conditions were followed:
 | - :mod:`input.visual`, the model of interest, and :mod:`dabble.fps` nodes were used to perform
     inference on videos
 | - 2 videos were used to benchmark each model, one with only 1 human (``single``), and the other
     with multiple humans (``multiple``)
 | - Both videos are about 1 minute each, recorded at ~30 FPS, which translates to about 1,800
     frames to process per video
 | - 1280×720 (HD ready) resolution was used, as a bridge between 640×480 (VGA) of poorer quality
     webcams, and 1920×1080 (Full HD) of CCTVs

Model Accuracy
--------------

The table below shows the performance of our Instance Segmentation models using the detection evaluation
metrics from COCO. Description of these metrics can be found `here <https://cocodataset.org/#detection-eval>`__.

Evaluation on masks
^^^^^^^^^^^^^^^^^^^

+--------------+-----------+------------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
| Model        | Type      | Size       | AP   | AP :sup:`IoU=.50` | AP :sup:`IoU=.75` | AP :sup:`small` | AP :sup:`medium` | AP :sup:`large` | AR :sup:`max=1` | AR :sup:`max=10` | AR :sup:`max=100` | AR :sup:`small` | AR :sup:`medium` | AR :sup:`large` |
+==============+===========+============+======+===================+===================+=================+==================+=================+=================+==================+===================+=================+==================+=================+
|              | r50-fpn   | 800-1333   | 34.5 | 56.0              | 36.7              | 17.8            | 37.9             | 47.1            | 29.7            | 45.6             | 47.6              | 27.4            | 51.5             | 63.8            |
+              +-----------+------------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
| Mask R-CNN   | r101-fpn  | 800-1333   | 37.1 | 59.0              | 39.7              | 20.4            | 41.1             | 49.8            | 31.4            | 49.1             | 51.4              | 31.9            | 55.7             | 67.2            |
+--------------+-----------+------------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+

Evaluation on bounding boxes
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

+--------------+-----------+------------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
| Model        | Type      | Size       | AP   | AP :sup:`IoU=.50` | AP :sup:`IoU=.75` | AP :sup:`small` | AP :sup:`medium` | AP :sup:`large` | AR :sup:`max=1` | AR :sup:`max=10` | AR :sup:`max=100` | AR :sup:`small` | AR :sup:`medium` | AR :sup:`large` |
+==============+===========+============+======+===================+===================+=================+==================+=================+=================+==================+===================+=================+==================+=================+
|              | r50-fpn   | 800-1333   | 37.6 | 59.1              | 40.9              | 21.3            | 41.3             | 49.3            | 31.3            | 49.3             | 51.6              | 32.1            | 55.6             | 66.5            |
+              +-----------+------------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
| Mask R-CNN   | r101-fpn  | 800-1333   | 41.7 | 62.2              | 45.2              | 24.4            | 45.8             | 54.4            | 34.3            | 54.5             | 57.2              | 37.6            | 61.5             | 72.4            |
+--------------+-----------+------------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+

Dataset
^^^^^^^

The `MS COCO <https://cocodataset.org/#download>`__ (val 2017) dataset is used. We integrated the
COCO API into the PeekingDuck pipeline for loading the annotations and evaluating the outputs from
the models. All values are reported in percentages.

All images from the 80 object categories in the MS COCO (val 2017) dataset were processed.

Test Conditions
^^^^^^^^^^^^^^^

The following test conditions were followed:
 | - The tests were performed using `pycocotools <https://pypi.org/project/pycocotools/>`__ on the
     MS COCO dataset
 | - The evaluation metrics have been compared with the original repository of the respective instance
     segmentation models for consistency

Instance Segmentation IDs
=========================

.. _general-instance-segmentation-ids:

General Instance Segmentation
-----------------------------
| The tables below provide the associated indices for each class.
| To detect all classes, specify :code:`detect: ["*"]` under the instance segmentation node configuration in ``pipeline_config.yml``.

+---------------+--------------+----------------+--------------+
|               | ID           |                | ID           |
|               +--------------+                +--------------+
| Class name    | Mask R-CNN   | Class name     | Mask R-CNN   |
+===============+==============+================+==============+
| person        | 0            | elephant       | 21           |
+---------------+--------------+----------------+--------------+
| bicycle       | 1            | bear           | 22           |
+---------------+--------------+----------------+--------------+
| car           | 2            | zebra          | 23           |
+---------------+--------------+----------------+--------------+
| motorcycle    | 3            | giraffe        | 24           |
+---------------+--------------+----------------+--------------+
| aeroplane     | 4            | backpack       | 26           |
+---------------+--------------+----------------+--------------+
| bus           | 5            | umbrella       | 27           |
+---------------+--------------+----------------+--------------+
| train         | 6            | handbag        | 30           |
+---------------+--------------+----------------+--------------+
| truck         | 7            | tie            | 31           |
+---------------+--------------+----------------+--------------+
| boat          | 8            | suitcase       | 32           |
+---------------+--------------+----------------+--------------+
| traffic light | 9            | frisbee        | 33           |
+---------------+--------------+----------------+--------------+
| fire hydrant  | 10           | skis           | 34           |
+---------------+--------------+----------------+--------------+
| stop sign     | 12           | snowboard      | 35           |
+---------------+--------------+----------------+--------------+
| parking meter | 13           | sports ball    | 36           |
+---------------+--------------+----------------+--------------+
| bench         | 14           | kite           | 37           |
+---------------+--------------+----------------+--------------+
| bird          | 15           | baseball bat   | 38           |
+---------------+--------------+----------------+--------------+
| cat           | 16           | baseball glove | 39           |
+---------------+--------------+----------------+--------------+
| dog           | 17           | skateboard     | 40           |
+---------------+--------------+----------------+--------------+
| horse         | 18           | surfboard      | 41           |
+---------------+--------------+----------------+--------------+
| sheep         | 19           | tennis racket  | 42           |
+---------------+--------------+----------------+--------------+
| cow           | 20           | bottle         | 43           |
+---------------+--------------+----------------+--------------+

+---------------+--------------+----------------+--------------+
|               | ID           |                | ID           |
|               +--------------+                +--------------+
| Class name    | Mask R-CNN   | Class name     | Mask R-CNN   |
+===============+==============+================+==============+
| wine glass    | 45           | dining table   | 66           |
+---------------+--------------+----------------+--------------+
| cup           | 46           | toilet         | 69           |
+---------------+--------------+----------------+--------------+
| fork          | 47           | tv             | 71           |
+---------------+--------------+----------------+--------------+
| knife         | 48           | laptop         | 72           |
+---------------+--------------+----------------+--------------+
| spoon         | 49           | mouse          | 73           |
+---------------+--------------+----------------+--------------+
| bowl          | 50           | remote         | 74           |
+---------------+--------------+----------------+--------------+
| banana        | 51           | keyboard       | 75           |
+---------------+--------------+----------------+--------------+
| apple         | 52           | cell phone     | 76           |
+---------------+--------------+----------------+--------------+
| sandwich      | 53           | microwave      | 77           |
+---------------+--------------+----------------+--------------+
| orange        | 54           | oven           | 78           |
+---------------+--------------+----------------+--------------+
| broccoli      | 55           | toaster        | 79           |
+---------------+--------------+----------------+--------------+
| carrot        | 56           | sink           | 80           |
+---------------+--------------+----------------+--------------+
| hot dog       | 57           | refrigerator   | 81           |
+---------------+--------------+----------------+--------------+
| pizza         | 58           | book           | 83           |
+---------------+--------------+----------------+--------------+
| donut         | 59           | clock          | 84           |
+---------------+--------------+----------------+--------------+
| cake          | 60           | vase           | 85           |
+---------------+--------------+----------------+--------------+
| chair         | 61           | scissors       | 86           |
+---------------+--------------+----------------+--------------+
| couch         | 62           | teddy bear     | 87           |
+---------------+--------------+----------------+--------------+
| potted plant  | 63           | hair drier     | 88           |
+---------------+--------------+----------------+--------------+
| bed           | 64           | toothbrush     | 89           |
+---------------+--------------+----------------+--------------+
